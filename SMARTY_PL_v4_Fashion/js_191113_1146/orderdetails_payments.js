
if(typeof orderFirstPay=='undefined'){var orderFirstPay='';}
app_shop.fn.evalAllJSFromHtml=function(html){var newElement=document.createElement('div');newElement.innerHTML=html;var result=newElement.getElementsByTagName("script");var scripts=[];for(var i=0;i<result.length;++i){if(result[i].tagName==='SCRIPT'){scripts.push(result[i]);}}
$('body').append(scripts);};var pbM='';var orderdetails_payments={paymentID:-1,payment_target:'',test:false,timeoutAjax:20000,other_payments:'',retry_payment:'',fn_submit_credit_card:function(){return true;},fn_submit_blik:function(){return true},fn_submit_form:function(){return true;},fn_submit_installment_plan:function(){return true;},slideSite:function(){if($('#go_payment').size()){$('html, body').animate({scrollTop:$('#go_payment').offset().top-150},'fast');}},dialog:function(html,destination,warning){$('.selected_payment_history').remove();$("#go_payment").remove();dialogHTML='';dialogHTML+='<div id="go_payment">'+html+'</div>';if(app_shop.vars.view>2){if($(destination).length){$(destination).html(dialogHTML);}else{$(dialogHTML).appendTo('.orderdetails_summary');}}else{if(warning){$("#ui-dialog").remove()
dialogHTML='';dialogHTML+='<div id="ui-dialog_content">'+html+'</div>';$('<div id="ui-dialog">'+dialogHTML+'</div>').appendTo('body');$('#ui-dialog').dialog({'wrappContent':true,'fixed':false,'fitToWindow':false});$('<h2>'+txt_62619_payment_title+'</h2>').prependTo('#dialog_wrapper');$('<div id="ui-dialog_button"><button onclick="$(\'#dialog_close\').click();">'+txt_62619_close_window+'</button></div>').appendTo('#dialog_wrapper');$('#dialog_wrapper_sub.setMaxHeightWindow').css('max-height',$('#dialog_wrapper_sub').height()-($('#ui-dialog_button').outerHeight()+$('#dialog_wrapper h2:first').outerHeight()));}else{$(dialogHTML).prependTo(orderdetails_payments.payment_target+' > .mobile_payment_content');}}
if(!$('#credit_card_agree > *').length){$('#credit_card_agree').hide()}
if(!$('#credit_card_buttons > *').length){$('#credit_card_buttons').hide()}
orderdetails_payments.slideSite();},ajaxLoadSite:function(flaga){if(!flaga){$('#ajaxLoadSite').remove();$('#ajaxLoadSite_cover').remove();}else{$('#ajaxLoadSite').remove();$('#ajaxLoadSite_cover').remove();$("body").append("<div id='ajaxLoadSite_cover'></div>");$('#ajaxLoadSite_cover').css({'height':$(document).height(),'width':$(window).width(),'position':'absolute','left':'0px','top':'0px'})
$('body').append('<div id="ajaxLoadSite">');$("#ajaxLoadSite").css({'left':(($(window).width()/2)-($("#ajaxLoadSite").width()/2))});}},warning:function(xmlOprderPayment){if(xmlOprderPayment.warning.order_newpayment_voucher_error){errorHTML='<div id="dialog_warning">';errorHTML+=txt_62619_voucher_error;switch(xmlOprderPayment.warning.order_newpayment_voucher_error){case'v1':errorHTML+=txt_62619_voucher_error_v1;break;case'v2':errorHTML+=txt_62619_voucher_error_v2;break;case'v3':errorHTML+=txt_62619_voucher_error_v3;break;case'v4':errorHTML+=txt_62619_voucher_error_v4;break;case'v5':errorHTML+=txt_62619_voucher_error_v5;break;case'v6':errorHTML+=txt_62619_voucher_error_v6;break;case'v7':errorHTML+=txt_62619_voucher_error_v7;break;case'v8':errorHTML+=txt_62619_voucher_error_v8;break;}
errorHTML+='</div>';orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.dialog(errorHTML,false,false,true);}else if(xmlOprderPayment.warning.onlyHttps==""){orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.dialog('<div id="dialog_warning">'+txt_62619_https_error+'</div>',false,true);}else if(xmlOprderPayment.warning.order_newpayment_hhtransfer_error==""){orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.dialog('<div id="dialog_warning">'+txt_62619_hhtransfer_error+'</div>',false,true);}else if(xmlOprderPayment.warning.order_newpayment_incorrect_paymentid==""){orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.dialog('<div id="dialog_warning">'+txt_62619_incorrect_paymentid+'</div>',false,true);}else if(xmlOprderPayment.warning.order_newpayment_error==""){orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.dialog('<div id="dialog_warning">'+txt_62619_newpayment_error+'</div>',false,true);}else if(xmlOprderPayment.warning.order_newpayment_points_error==""){orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.dialog('<div id="dialog_warning">'+txt_62619_newpayment_points_error+'</div>',false,true);}
orderdetails_payments.go(0);},ajaxLoadSiteMessage:function(message){$('#ajaxLoadSite').append(message);$("#ajaxLoadSite").css({'left':(($(window).width()/2)-($("#ajaxLoadSite").width()/2))});},stringtoXML:function(text){if(window.ActiveXObject){var doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(text);}else{var parser=new DOMParser();var doc=parser.parseFromString(text,'text/xml');}
return doc;},getOrderPayment:function(urlLink,callback){orderdetails_payments.ajaxLoadSite(1);orderdetails_payments.ajaxLoadSiteMessage(txt_62619_loader_message);$('.blik_placeholder').hide();$.ajax({type:"GET",url:urlLink,dataType:"json",timeout:orderdetails_payments.timeoutAjax,success:function(xmlOprderPayment){if(xmlOprderPayment.warning){orderdetails_payments.warning(xmlOprderPayment);}else{if(xmlOprderPayment.errno==0){switch(xmlOprderPayment.payment_type){case'credit_card':var current_date=new Date();var current_year=current_date.getFullYear();var credit_card_array=[];var formClass='.embeded_card_form_'+xmlOprderPayment.payment_id;var formClone=$(formClass).clone(true);formClone.find('.clear_data').html('');formClone.removeAttr('onsubmit');formClone.find('[data-altid]').each(function(){var altid=$(this).attr('data-altid');$(this).attr('id',altid);});if(app_shop.fn.evalAllJSFromHtml){app_shop.fn.evalAllJSFromHtml(xmlOprderPayment.payment_xml);}
payment_xml=$(xmlOprderPayment.payment_xml);var cart_type=$(payment_xml).find('payform').attr('type');formClone.removeAttr('payment_type_'+cart_type).addClass('payment_type_'+cart_type);formClone.find('#paymentdescription, div.payment_description').remove();if(xmlOprderPayment.payment_description){if(xmlOprderPayment.payment_id=='25'){formClone.append('<div id="paymentdescription">'+xmlOprderPayment.payment_description+'</div>');}else{formClone.find('div.payment_head_info').append('<div class="payment_description">'+xmlOprderPayment.payment_description+'</div>');}}
if(cart_type=='one_click'){formClone.find('div.payment_card_info').hide();}
if($('headermessage',payment_xml).html()){formClone.find('div.payment_headermessage').html($('headermessage',payment_xml).html());formClone.find('div.payment_head_info').show();}
if($('headerlogo',payment_xml).html()){formClone.find('div.payment_headerlogo img').attr('src',$('headerlogo',payment_xml).text());formClone.find('div.payment_head_info').show();}
if(cart_type=='one_click'||cart_type=='form'){formClone.find('#firstData-info').remove();if($('headerdescription',payment_xml).html()){formClone.find('div.payment_headerlogo').append('<div id="firstData-info">'+$('headerdescription',payment_xml).html())}}
formClone.find('input').attr('disabled',true);formClone.find('div.form-group').hide();$('item',payment_xml).each(function(){var $this=$(this);var $clas=$this.attr('class')?$this.attr('class'):'';if($this.attr('name')=='creditCard[system]'){$('item["name=creditCard[system]"] option',payment_xml).each(function(){var $this=$(this);credit_card_array.push($this.attr('label').toLowerCase());var item=$('<label>').attr({'class':'card-icon','id':'card_icon_'+$this.attr('value'),}).append($('<input>').attr({'class':'validate required','type':'radio','name':'creditCard[system]','value':$this.attr('value'),'data-serialize':'#credit_card_system input'})).append($('<div>').append(function(){console.log($this);if($this.attr('data-img')){return $('<img>').attr({'src':$this.attr('data-img'),'alt':$this.attr('label')})}else{return''}}).append(function(){if($this.attr('data-img')){return''}else{return $('<span>').text($this.attr('label'))}}));formClone.find('#credit_card_system').append(item);})
if($('item["name=creditCard[system]"] option',payment_xml).size()==1){}}else if($this.attr('type')=='checkbox'){if($this.find('description')){var txt=$this.find('description').html();}
var item=$('<label>').append($('<input>').attr({'class':$clas,'type':'checkbox','name':$this.attr('name'),'value':$this.attr('value')})).append($('<span>').text(txt))
formClone.find('#credit_card_agree').append(item);}else if($this.attr('type')=='link'){if($this.find('description')){var txt=$this.find('description').html();}
var item=$('<a>').attr({'href':decodeURIComponent($this.attr('href')),'id':$this.attr('id')}).text(txt);formClone.find('#credit_card_buttons').append(item);}
if($this.attr('name')=='useStore'){var item=$('<input>').attr({'type':'hidden','name':$this.attr('name'),'value':$this.attr('value'),'class':$clas});formClone.find('#credit_card_buttons').append(item);}else{var element=formClone.find('[name="'+$this.attr('name')+'"]');if($this.attr('value')){element.val($this.attr('value'));}
element.attr('disabled',false).addClass($clas).parents('.form-group').show();if($this.attr('readonly')){element.addClass('readonly correct').attr('readonly',true).attr('disabled',true);}else{element.removeClass('readonly').attr('readonly',false).attr('disabled',false);}}});formClone.find('[data-altname]').each(function(){var altName=$(this).attr('data-altname');$(this).attr('name',altName);});orderdetails_payments.dialog(formClone.html(),$('#card_payment_container'));cardHandler.init($('#go_payment'),credit_card_array,current_year);orderdetails_payments.go(1);if($('[type="one_click"]',payment_xml).size()){$('#go_payment').find('div.payment_card_info').hide();}
if(xmlOprderPayment.payment_id=='25'){$('#go_payment').find('#payment_card_info_static').show();}else{$('#go_payment').find('#payment_card_info_static').hide();}
break;case'blik':if(!xmlOprderPayment.payment_code){orderdetails_payments.ajaxLoadSite(1);payment_xml=$(xmlOprderPayment.payment_xml);var method=$(payment_xml).attr('method');var action=$(payment_xml).attr('action');var paymentHTML='<form class="payment_popup_submit_blik" id="form-blik" method="'+method+'" action="'+action+'">';if(xmlOprderPayment.payment_description){paymentHTML+='<div class="payment_head_info clearfix">'+xmlOprderPayment.payment_description+'</div>';}
$('item',payment_xml).each(function(){$this=$(this);if($this.attr('name')=='blik_code'){paymentHTML+='<div class="form-group row d-sm-none"><div class="col-12"><label class="orderdetails_summary_form_label">'+txt_blikCode+'</label></div><div class="col-12"><input class="form-control" type="number" name="'+$this.attr('name')+'" value="'+$this.attr('value')+'" required /></div></div>';}else{paymentHTML+='<input type="hidden" name="'+$this.attr('name')+'" value="'+$this.attr('value')+'" />';}});paymentHTML+='<div class="form-group row"><div class="col-12"><button class="btn-large col-12" type="submit">'+txt_62619_dokonaj_platnosci+'</button></div></div>';paymentHTML+='<div class="blik_message"><div class="n54531_outline_sub menu_messages_message" id="return_sub_wisheslist_empty"><h3 class="return_label">'+blik_js_txt_confirm+'</h3></div></div>';paymentHTML+='</form>';orderdetails_payments.ajaxLoadSite(0);if(app_shop.vars.view!=1){$('.blik_placeholder').show();}
orderdetails_payments.go(1,function(){orderdetails_payments.dialog(paymentHTML,false);});}else{paymentHTML='';if(xmlOprderPayment.payment_description)
paymentHTML+='<div id="paymentdescription">'+xmlOprderPayment.payment_description+'</div>';if(xmlOprderPayment.payment_code)
paymentHTML+='<div id="payment_code">'+xmlOprderPayment.payment_code+'</div>';orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.go(1,function(){orderdetails_payments.dialog(paymentHTML,false);});}
break;case'transfer':orderdetails_payments.go(1);break;case'voucher':orderdetails_payments.go(1);break;case'form':var isTermsPopup=false;if(xmlOprderPayment.agreement)var txt_terms=xmlOprderPayment.agreement.toplayerContent;paymentHTML='';if(xmlOprderPayment.payment_description)
paymentHTML+='<div id="paymentdescription">'+xmlOprderPayment.payment_description+'</div>';if(xmlOprderPayment.form_data){paymentHTML+='<form class="payment_popup_submit_form" method="'+xmlOprderPayment.form_data.method+'" action="'+xmlOprderPayment.form_data.action+'" target="'+xmlOprderPayment.form_data.target+'">';for(i in xmlOprderPayment.form_data.inputs){if(xmlOprderPayment.form_data.inputs[i].type=='terms'&&txt_terms_title){isTermsPopup=true;if(xmlOprderPayment.data.iai_service)paymentHTML+='<div class="iai_service_logo"></div>';paymentHTML+='<div class="terms_description cm">';if(xmlOprderPayment.onside_terms==true)paymentHTML+='<p>'+txt_terms+'</p>';if(xmlOprderPayment.form_data.inputs[i].url)
paymentHTML+='<div style="text-align:center;margin-bottom:20px;font-size:15px" class="show_terms_btn"><a target="_blank" href="'+xmlOprderPayment.form_data.inputs[i].url+'" class="btn-regular show_terms_btn">'+txt_terms_link+'</a></div>';paymentHTML+='<div class="checkbox"><label><input type="checkbox" required id="terms_iai_pay_checkbox" value="'+xmlOprderPayment.form_data.inputs[i].value+'" name="'+xmlOprderPayment.form_data.inputs[i].name+'"/>'+txt_terms_checkbox+'</label></div>'
paymentHTML+='</div>';}
if(xmlOprderPayment.form_data.inputs[i].type=='hidden'){paymentHTML+='<input type="'+xmlOprderPayment.form_data.inputs[i].type+'" value="'+xmlOprderPayment.form_data.inputs[i].value+'" name="'+xmlOprderPayment.form_data.inputs[i].name+'"/>';}
if(xmlOprderPayment.form_data.inputs[i].type=='radio'){paymentHTML+='<div class="orderpaymentradio"><label>';if(xmlOprderPayment.form_data.inputs[i].checked){paymentHTML+='<input type="'+xmlOprderPayment.form_data.inputs[i].type+'" value="'+xmlOprderPayment.form_data.inputs[i].value+'" name="'+xmlOprderPayment.form_data.inputs[i].name+'" checked="checked" />';}else{paymentHTML+='<input type="'+xmlOprderPayment.form_data.inputs[i].type+'" value="'+xmlOprderPayment.form_data.inputs[i].value+'" name="'+xmlOprderPayment.form_data.inputs[i].name+'"/>';}
paymentHTML+='<img src="'+xmlOprderPayment.form_data.inputs[i].label_img+'"/>';paymentHTML+='<span>'+xmlOprderPayment.form_data.inputs[i].label_name+'</span></label></div>';}
if(xmlOprderPayment.form_data.inputs[i].type=='button'){paymentHTML+='<button type="submit" ';if(xmlOprderPayment.form_data.inputs[i].className){paymentHTML+=' value="'+xmlOprderPayment.form_data.inputs[i].value+'"';}
if(xmlOprderPayment.form_data.inputs[i].className){paymentHTML+=' class="'+xmlOprderPayment.form_data.inputs[i].className+' btn-large"';}else{paymentHTML+=' class="orderdetails_paygate_finalize btn-large"';}
if(xmlOprderPayment.form_data.inputs[i].id){paymentHTML+=' id="'+xmlOprderPayment.form_data.inputs[i].id+'"';}
if(!isTermsPopup)
paymentHTML+=' onclick="orderdetails_payments.restartPayment()" ';paymentHTML+=' >';if(xmlOprderPayment.form_data.inputs[i].img){paymentHTML+='<img src="'+xmlOprderPayment.form_data.inputs[i].img+'" />';}
paymentHTML+=txt_62619_dokonaj_platnosci;paymentHTML+='</button>';}}
paymentHTML+='</form>';}
orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.go(1,function(){orderdetails_payments.dialog(paymentHTML,false);});break;case'installment_plan':paymentHTML='';if(xmlOprderPayment.form_data){paymentHTML+='<form class="payment_popup_submit_installment_plan cm" method="'+xmlOprderPayment.form_data.method+'" action="'+xmlOprderPayment.form_data.action+'" target="'+xmlOprderPayment.form_data.target+'">';for(i in xmlOprderPayment.form_data.inputs){if(xmlOprderPayment.form_data.inputs[i].type=='hidden'){paymentHTML+='<input type="'+xmlOprderPayment.form_data.inputs[i].type+'" value="'+xmlOprderPayment.form_data.inputs[i].value+'" name="'+xmlOprderPayment.form_data.inputs[i].name+'"/>';}
if(xmlOprderPayment.form_data.inputs[i].type=='radio'){paymentHTML+='<div class="orderpaymentradio"><label>';if(xmlOprderPayment.form_data.inputs[i].checked){paymentHTML+='<input type="'+xmlOprderPayment.form_data.inputs[i].type+'" value="'+xmlOprderPayment.form_data.inputs[i].value+'" name="'+xmlOprderPayment.form_data.inputs[i].name+'" checked="checked" />';}else{paymentHTML+='<input type="'+xmlOprderPayment.form_data.inputs[i].type+'" value="'+xmlOprderPayment.form_data.inputs[i].value+'" name="'+xmlOprderPayment.form_data.inputs[i].name+'"/>';}
paymentHTML+='<img src="'+xmlOprderPayment.form_data.inputs[i].label_img+'"/>';paymentHTML+='<span>'+xmlOprderPayment.form_data.inputs[i].label_name+'</span></label></div>';}
if(xmlOprderPayment.form_data.inputs[i].type=='html'){paymentHTML+=xmlOprderPayment.form_data.inputs[i].value;}
if(xmlOprderPayment.form_data.inputs[i].type=='button'){if(xmlOprderPayment.payment_description&&xmlOprderPayment.payment_id==21)
paymentHTML+='<div id="paymentdescription">'+xmlOprderPayment.payment_description+'</div>';paymentHTML+='<div class="paymentbutton-wrapper" style="text-align:center;"><button type="submit" ';if(xmlOprderPayment.form_data.inputs[i].className){paymentHTML+=' value="'+xmlOprderPayment.form_data.inputs[i].value+'"';}
if(xmlOprderPayment.form_data.inputs[i].className){paymentHTML+=' class="'+xmlOprderPayment.form_data.inputs[i].className+' btn-large"';}else{paymentHTML+=' class="btn-large';}
if(xmlOprderPayment.form_data.inputs[i].id){paymentHTML+=' id="'+xmlOprderPayment.form_data.inputs[i].id+'"';}
paymentHTML+=' >';if(xmlOprderPayment.form_data.inputs[i].img){paymentHTML+='<img src="'+xmlOprderPayment.form_data.inputs[i].img+'" />';}
paymentHTML+=txt_62619_wypelnij_wniosek;paymentHTML+='</button></div>';}}
paymentHTML+='</form>';if(xmlOprderPayment.payment_description&&xmlOprderPayment.payment_id!=21)
paymentHTML+='<div id="paymentdescription">'+xmlOprderPayment.payment_description+'</div>';}
orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.go(1,function(){orderdetails_payments.dialog(paymentHTML,false);});if($('#zagiel_confirm').size()){$('#zagiel_confirm').parents('form').attr('onsubmit','return validate_Zagiel()')}
break;default:paymentHTML='';if(xmlOprderPayment.payment_description)
paymentHTML+='<div id="paymentdescription">'+xmlOprderPayment.payment_description+'</div>';if(xmlOprderPayment.payment_code)
paymentHTML+='<div id="payment_code">'+xmlOprderPayment.payment_code+'</div>';orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.go(1,function(){orderdetails_payments.dialog(paymentHTML,false,true);});break;}
if(xmlOprderPayment.javascript){eval(xmlOprderPayment.javascript);}}else if(xmlOprderPayment.info=="no_data_for_payment"){orderdetails_payments.go(1);}else if(xmlOprderPayment.errno==1){orderdetails_payments.paymentError();}}},error:function(){orderdetails_payments.paymentError();}})},checkForm:function(cancel_link){if($('#dialog_wrapper .validate:enabled').filter(function(){return!$(this).val()}).size()||$('#dialog_wrapper .validate:visible:enabled.error').size()){Alertek.show_alert(creditcard_alert);return false;}else if($('#dialog_wrapper .validate:visible:enabled:not(.error):not(.correct)').size()){$('#dialog_wrapper .validate:visible:enabled:not(.error):not(.correct)').each(function(){$this=$(this);validate_cart(function(){$('#dialog_wrapper button.credit_card_submit_no_store').click();});});}else{return true;}
return false;},cancelPayment:function(cancel_link){orderdetails_payments.ajaxLoadSite(1);orderdetails_payments.ajaxLoadSiteMessage(txt_62619_loader_message_4);$.ajax({type:"POST",url:cancel_link,dataType:"json",timeout:orderdetails_payments.timeoutAjax,success:function(json){if(json.warning){orderdetails_payments.warning(json);}else{if(json.errno==0){orderdetails_payments.go(1);}else if(json.info=="no_data_for_payment"){orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.go(1);}else if(json.errno==1){orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.go(0);orderdetails_payments.dialog('<div id="dialog_warning">'+txt_62619_paymentCancelError+'</div>',false,true);}}},error:function(){orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.go(0);orderdetails_payments.dialog('<div id="dialog_warning">'+txt_62619_paymentCancelError+'</div>',false,true);}});},restartPayment:function(){orderdetails_payments.ajaxLoadSite(1);orderdetails_payments.ajaxLoadSiteMessage(txt_62619_loader_message3);$('.selected_group, input[name="payform_id"]').attr('checked',false);$('.group_open').removeClass('group_open');$.ajax({type:'GET',url:'/orderdetails.php?id='+orderID+'&shop_xml=1&get_ajax_items=orderdetails_summary_price'+(orderKey?'&key='+orderKey:''),success:function(obj){$("#go_payment").hide();$('.orderdetails_summary_price').replaceWith($(obj.orderdetails_summary_price));orderdetails_payments.ajaxLoadSite(0);},error:function(){$("#go_payment").hide();orderdetails_payments.ajaxLoadSite(0);$('input[name="payform_id"]').attr('checked',false);}})},choicePayment:function(form){if(!form.find(' input[name=payform_id]:checked').size()){Alertek.show_alert(txt_62619_select_payment_method);return false;}
orderdetails_payments.ajaxLoadSite(1);orderdetails_payments.ajaxLoadSiteMessage(txt_62619_loader_message2);var method=form.data('method');var action=form.data('action');var payform_id=form.find(' input[name=payform_id]:checked').val();if(form.find('input[name=voucher_id]').length>0)
var voucher_id=form.find("input[name=voucher_id]").val();else
var voucher_id='';if(form.find('input[name=pin_value]').length>0)
var pin_value=form.find("input[name=pin_value]").val();else
var pin_value="";if(form.find('input[name=profit_points]').length>0)
var profit_points=form.find('input[name=profit_points]').val();else
var profit_points='';ajaxUrl=action+'&ajax=true';if($("#dialog_wrapper").find("#giftcard_data").length||$("#dialog_wrapper").find("#voucher_data").length)
$("#dialog_close").click();if(orderdetails_payments_cancel_link){$.ajax({type:"POST",url:orderdetails_payments_cancel_link,dataType:"json",timeout:orderdetails_payments.timeoutAjax,success:function(json){if(json.warning){orderdetails_payments.warning(json);}else{if(json.errno==0){$.ajax({type:"POST",url:ajaxUrl,dataType:"json",timeout:orderdetails_payments.timeoutAjax,data:{payform_id:payform_id,voucher_id:voucher_id,pin_value:pin_value,profit_points:profit_points},success:function(json){if(json.warning){orderdetails_payments.warning(json);}else{$('#go_payment').remove();if(json.errno==0){if(json.link){orderdetails_payments.getOrderPayment(json.link+"&ajax=true");}else{orderdetails_payments.go(1);}}else if(json.info=="no_data_for_payment"){orderdetails_payments.ajaxLoadSite(0);}else if(json.errno==1){orderdetails_payments.paymentError();}}},error:function(){orderdetails_payments.paymentError();}});}else if(json.info=="no_data_for_payment"){orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.go(1);}else if(json.errno==1){orderdetails_payments.paymentError();}}},error:function(){orderdetails_payments.paymentError();}});}else{$.ajax({type:"POST",url:ajaxUrl,dataType:"json",timeout:orderdetails_payments.timeoutAjax,data:{payform_id:payform_id,voucher_id:voucher_id,profit_points:profit_points},success:function(json){if(json.warning){orderdetails_payments.warning(json);}else{$('#go_payment').remove();if(json.errno==0){if(json.link){orderdetails_payments.getOrderPayment(json.link+"&ajax=true");}else{orderdetails_payments.go(1);}}else if(json.info=="no_data_for_payment"){orderdetails_payments.ajaxLoadSite(0);}else if(json.errno==1){orderdetails_payments.paymentError();}}},error:function(){orderdetails_payments.paymentError();}});}},paymentError:function(){orderdetails_payments.ajaxLoadSite(0);orderdetails_payments.go(0);orderdetails_payments.dialog('<div id="dialog_warning">'+txt_62619_paymentError+'</div>',false,true);},setCancelLink:function(){if($('#orderdetails_payments').data('cancel_link')){orderdetails_payments_cancel_link=$('#orderdetails_payments').data('cancel_link')+'&ajax=true';}else{orderdetails_payments_cancel_link=false;}},visualChanges:function(obj){$('.payments_group .payment_icon').each(function(){$(this).attr('src',$(this).attr('data-src'));})
var current_payment_group=obj.parents('.payments_group');var current_payment_icon=obj.parents('.prepaid_payment').find('.prepaid_payment_icon').attr('src');current_payment_group.find('.payment_icon').attr('src',current_payment_icon);$('.payments_group > input.selected_group').attr('checked',false);$('.group_open').removeClass('group_open');$('.popup_payment_open').removeClass('popup_payment_open');current_payment_group.find('input.selected_group').attr('checked','checked');current_payment_group.addClass('group_open');orderdetails_payments.payment_target='#'+current_payment_group.attr('id');},go:function(flaga,callback){if(flaga){orderdetails_payments.ajaxLoadSite(1);orderdetails_payments.ajaxLoadSiteMessage(txt_62619_loader_message3);$.ajax({type:'GET',url:'/orderdetails.php?id='+orderID+'&shop_xml=1&get_ajax_items=orderdetails_payments,orderdetails_summary_price'+(orderKey?'&key='+orderKey:''),success:function(obj){$('#orderdetails_payments').replaceWith($(obj.orderdetails_payments));$('.orderdetails_summary_price').replaceWith($(obj.orderdetails_summary_price));orderdetails_payments.setCancelLink();var transfer_obj=$('.orderdetails_payments_content > table > tbody > tr:last-child .orderdetails_transfer');if(transfer_obj.length){orderdetails_payments.dialog('<table>'+transfer_obj.html()+'</table>','#simple_transfer_payment #simple_transfer_payment_container');$('#simple_transfer_payment').addClass('group_open');}else{$('#simple_transfer_payment').removeClass('group_open');}
if(flaga)
orderdetails_payments.ajaxLoadSite(0);if(callback){callback();}},error:function(){if(flaga){orderdetails_payments.paymentError();orderdetails_payments.slideSite();}}})}},unbind:function(){$('.payments_group:not(#blik_payment):not(#simple_transfer_payment) .payments_group_sub_content').die();$('.close_popup_payment').die();$('.change_payment_method').die();$('.payments_group_sub_content').die();},bind_desktop:function(){$('.payments_group_sub_content').live('click.desktop_event',function(){$(this).parent().toggleClass('group_open');});},bind_mobile:function(){$('.payments_group:not(#blik_payment):not(#simple_transfer_payment) .payments_group_sub_content').live('click.mobile_event',function(){$(this).parent().addClass('popup_payment_open');});$('.close_popup_payment').live('click.mobile_event',function(){$(this).parents('.payments_group').removeClass('popup_payment_open');});$('.change_payment_method').live('click.mobile_event',function(){var payment_group=$(this).parents('.payments_group');$('.payments_group .payment_icon').each(function(){$(this).attr('src',$(this).attr('data-src'));})
$('.payments_group > input.selected_group').attr('checked',false);$('.orderdetails_prepaid_methods input[name="payform_id"]').attr('checked',false);payment_group.removeClass('popup_payment_open');payment_group.removeClass('group_open');$('#go_payment').remove();});}}
function setGiftcardError(obj){obj.parent('.has-feedback').removeClass('has-required').removeClass('has-success').addClass('has-error');}
function setGiftcardSuccess(obj){obj.parent('.has-feedback').removeClass('has-required').removeClass('has-error').addClass('has-success');}
app_shop.run(function(){orderdetails_payments.ajaxLoadSite(0);$('#LukasRatySubmit').live('click',function(){if($('#LukasRatyConfirm').prop('checked')){return true;}
else{if(window['lukasnotconfirmed'])
alert(lukasnotconfirmed);return false;}});$('.payments_group .payment_icon').each(function(){$(this).attr('data-src',$(this).attr('src'));})
$('form.payment_card button.credit_card_submit_no_store').live('click',function(event){if(orderdetails_payments.checkForm()&&orderdetails_payments.fn_submit_credit_card(event)){$(this).parent().find('button').addClass('load-btn disabled').prop('disabled',true);$('#credit_card_agree input[type="checkbox"]').prop("checked",false);return true;}
return false;});$('form.payment_card button.credit_card_submit_store').live('click',function(event){if(orderdetails_payments.checkForm()&&orderdetails_payments.fn_submit_credit_card(event)){$(this).parent().find('button').addClass('load-btn disabled').prop('disabled',true);$('#credit_card_agree input[type="checkbox"]').prop("checked",true);return true;}
return false;});$('.payment_popup_submit_blik').live('submit',function(event){if($('input[name="blik_code"]').val().length<6){Alertek.show_alert(txt_62619_blik_length_error);return false;}else{return orderdetails_payments.fn_submit_blik(event);}});$('.payment_popup_submit_form').live('submit',function(event){return orderdetails_payments.fn_submit_form(event);});$('.payment_popup_submit_installment_plan').live('submit',function(event){return orderdetails_payments.fn_submit_installment_plan(event);});$('a.add_voucher_button').live('click',function(){$('#payment_2').click();})
$('.payments_group .payment_icon').each(function(){$(this).attr('data-src',$(this).find('.payment_icon').attr('src'));})
orderdetails_payments.visualChanges($('.orderdetails_prepaid_methods input[name="payform_id"]:checked'));$('#payment_190').live('click',function(){orderdetails_payments.visualChanges($(this));orderdetails_payments.dialog($('#giftcard_data').html(),false);});$('#payment_2').live('click',function(){orderdetails_payments.visualChanges($(this))
orderdetails_payments.dialog($('#voucher_data').html(),false);});$('.orderdetails_prepaid_methods input[name="payform_id"]:not(#payform_2):not(#payform_190)').live('change',function(){orderdetails_payments.visualChanges($(this));orderdetails_payments.choicePayment($(this).parents('.orderdetails_prepaid_methods'));});$('#simple_transfer_payment > label, #blik_payment > label').live('click',function(){$(this).parent().find('input.hidden_input').click();});$('.show_history_container a').live('click',function(){$('.orderdetails_payments_content').toggle();return false;});$('#blik_placeholder_input, input[name="blik_code"]').live('change keyup blur paste',function(e){if(e.keyCode==13){$('.payment_popup_submit_blik').submit();}
var input_val=$(this).val().replace(/\D/g,'').slice(0,6);$('#blik_placeholder_input, input[name="blik_code"]').val(input_val);});$('#go_payment .giftcard_form').live('submit',function(){orderdetails_payments.ajaxLoadSite(1);orderdetails_payments.ajaxLoadSiteMessage(txt_order1_gift_voucher_verification);var $this=$(this);$.ajax({url:'/ajax/gift-cards-and-vouchers.php',type:'POST',data:{action:'auth',number:$this.find('input[name="voucher_id"]').val(),pin:$this.find('input[name="pin_value"]').val()},success:function(json){if(json.errno==0){setGiftcardSuccess($this.find('input[name="voucher_id"]'));setGiftcardSuccess($this.find('input[name="pin_value"]'));orderdetails_payments.choicePayment($this);}else{orderdetails_payments.ajaxLoadSite(0);if($this.is('#giftcard_form')){if(json.errno=='auth_error_2'){setGiftcardError($this.find('input[name="voucher_id"]'))
setGiftcardError($this.find('input[name="pin_value"]'))
Alertek.show_alert(txt_order1_giftcard_02);}else if(json.errno=='auth_error_3'){setGiftcardSuccess($this.find('input[name="voucher_id"]'));setGiftcardError($this.find('input[name="pin_value"]'))
Alertek.show_alert(txt_order1_giftcard_03);}else if(json.errno=='auth_error_4'){setGiftcardError($this.find('input[name="voucher_id"]'))
Alertek.show_alert(txt_order1_giftcard_04);}else if(json.errno=='auth_error_5'){setGiftcardError($this.find('input[name="voucher_id"]'))
setGiftcardError($this.find('input[name="pin_value"]'))
Alertek.show_alert(txt_order1_giftcard_05);}else if(json.errno=='auth_error_6'){setGiftcardError($this.find('input[name="pin_value"]'))
Alertek.show_alert(txt_order1_giftcard_06);}else if(json.errno=='auth_error_7'){setGiftcardError($this.find('input[name="pin_value"]'))
Alertek.show_alert(txt_order1_giftcard_07);}}else{setGiftcardError($this.find('input[name="voucher_id"]'))
Alertek.show_alert(txt_order1_voucher_01);}}}});return false});if($('.orderdetails_prepaid_methods input[name="payform_id"]').length==1){$('input[name="payform_id"]').each(function(){var $this=$(this);$this.parents('.payments_group').click();$('label[for="'+$this.attr('name')+'"]').click();})}
orderdetails_payments.setCancelLink();if(typeof orderFirstPay&&orderFirstPay.length){orderdetails_payments.getOrderPayment(orderFirstPay)}
orderdetails_payments.unbind();if(app_shop.vars.view<3){orderdetails_payments.bind_mobile();}else{orderdetails_payments.bind_desktop();}},'all','.prepaid_page');app_shop.run(function(){orderdetails_payments.unbind();},[1,2,3,4],'.prepaid_page')
app_shop.run(function(){orderdetails_payments.bind_mobile();},[1,2],'.prepaid_page');app_shop.run(function(){orderdetails_payments.bind_desktop();},[3,4],'.prepaid_page');var orderdetails_payments_cancel_link=false;var copy_description_prepaid=function(pID){if(!$('#payment_'+pID).hasClass('orderdetails_payment_disable')){$('div.description_box').hide();$('div.description_box').html('');if(pID!='later'){pID=parseInt(pID)}
if($('#description_'+pID).length&&$('#description_'+pID).html()!=''){if(pID!=2){$('#payment_'+pID).find('input.orderdetails_radio').attr("checked",true);$('#payment_'+pID).addClass('o1selectedpay');$('#payment_'+pID).nextAll('.description_box:first').html($('#description_'+pID).html());}else{$('#payment_'+pID).find('input.orderdetails_radio').attr("checked",true);$('#payment_'+pID).addClass('o1selectedpay');var bonHTML=$('#description_'+pID).html().toString();bonHTML=bonHTML.replace('voucher_id_copy','voucher_id');bonHTML=bonHTML.replace('order1_bon_copy','order1_bon');$('#payment_'+pID).parents('div.order1_payment_wrapper').find('div.description_box').html(bonHTML).show();Order1.validateBon();}
$('#payment_'+pID).nextAll('.description_box:first').show();}else{$('#payment_'+pID).find('input.orderdetails_radio').attr("checked",true);$('#payment_'+pID).addClass('o1selectedpay nodescription');}}}
var cardHandler={error:false,cvvInfoOpenInProgress:false,submitBtnNoStore:null,submitBtnStore:null,inputs:[],cardNumInput:null,cardCvvInput:null,cardHolderInput:null,cardExpiryMonthInput:null,cardExpiryYear:null,cardSystemArray:[],cardCvvLabel:null,init:function(form,cardSystemArr,currYear){this.form=form.find('form');this.submitBtnNoStore=form.find('.credit_card_submit_no_store');this.submitBtnStore=form.find('.credit_card_submit_store');this.cardNumInput=form.find('#credit_card_number');this.cardHolderInput=form.find('#credit_card_name');this.cardCvvInput=form.find('#credit_card_code');this.cardSystemArray=cardSystemArr;this.cardCvvLabel=form.find('label[for="credit_card_code"]');this.cardCvvLabelText=form.find('label[for="credit_card_code"]').text();this.replaceDateInputs(form,currYear);this.initEvents();this.blockSubmit();},replaceDateInputs:function(form,currYear){var month_HTML='<select name="'+form.find('#credit_card_month').attr('name')+'" id="'+form.find('#credit_card_month').attr('id')+'" class="form-control">';for(i=1;i<=12;i++){var temp_month=i<10?'<option value=0'+i+'>0'+i+'</option>':'<option value='+i+'>'+i+'</option>';month_HTML=month_HTML+temp_month;}
var month_HTML=month_HTML+'</select>';form.find('#credit_card_month').replaceWith(month_HTML);this.cardExpiryMonthInput=form.find('#credit_card_month');var year_HTML='<select name="year_placeholder" id="year_placeholder" class="form-control" style="width: auto; display: inline-block;">';var currentYear=currYear;for(i=currentYear;i<=currentYear+20;i++){var temp_year='<option value='+i+'>'+i+'</option>'
year_HTML=year_HTML+temp_year;}
var year_HTML=year_HTML+'</select>';form.find('#credit_card_year').hide();form.find('#credit_card_year').before(year_HTML);this.cardExpiryYear=form.find('#year_placeholder');},isCardNumberCorrect:function(number){var curr_card_type=this.getCardType();if(this.cardSystemArray.includes(curr_card_type)){if(number){return $.payform.validateCardNumber(number);}
return $.payform.validateCardNumber(this.cardNumInput.val());}else if(curr_card_type!=null){Alertek.show_alert(txt_62619_card_not_supported);return false}},isCvvCorrect:function(number){if(number){return $.payform.validateCardCVC(number,this.getCardType());}
return $.payform.validateCardCVC(this.cardCvvInput.val(),this.getCardType());},setError:function(el){el.parent().addClass('has-error').removeClass('has-success').removeClass('has-required');cardHandler.error=true;cardHandler.submitBtnNoStore.prop('disabled',true);cardHandler.submitBtnStore.prop('disabled',true);cardHandler.submitBtnNoStore.addClass('disabled');cardHandler.submitBtnStore.addClass('disabled');},setCorrect:function(el){if(typeof el!=='undefined'&&el){el.parent().removeClass('has-error').removeClass('has-required').addClass('has-success');}
if(!$('#go_payment .has-error').length){this.error=false;}
this.blockSubmit();},blockSubmit:function(){if(this.allDataEntered()&&!this.error){this.submitBtnNoStore.removeClass('disabled');this.submitBtnNoStore.prop('disabled',false);this.submitBtnStore.removeClass('disabled');this.submitBtnStore.prop('disabled',false);}else{this.submitBtnNoStore.addClass('disabled');this.submitBtnNoStore.prop('disabled',true);this.submitBtnStore.addClass('disabled');this.submitBtnStore.prop('disabled',true);}},allDataEntered:function(){return this.cardCvvInput.val().trim()!==''&&this.cardNumInput.val().trim()!==''&&this.cardHolderInput.val().trim()!=='';},initEvents:function(){var form=this.form;this.cardNumInput.on('change keyup blur',function(){cardHandler.markCardIcon();if(!cardHandler.isCardNumberCorrect($(this).val())){cardHandler.setError($(this));}else{cardHandler.setCorrect($(this));}
cardHandler.validateCvv();}).payform('formatCardNumber');this.cardCvvInput.payform('formatCardCVC');this.cardCvvInput.on('change keyup blur',function(){cardHandler.validateCvv();});form.find('#year_placeholder').on('change blur',function(){form.find('#credit_card_year').val($(this).val().toString().slice(-2));});this.cardExpiryMonthInput.on('change blur',function(){$.payform.fitYearSelect(cardHandler.cardExpiryYear,cardHandler.cardExpiryMonthInput.val())});this.cardExpiryMonthInput.change();this.cardHolderInput.on('change blur keyup',function(){if($(this).val().trim()===''){cardHandler.setError($(this));}else{cardHandler.setCorrect($(this));}});form.find('#credit_card_year').val(form.find('#year_placeholder').val().toString().slice(-2));},validateCvv:function(){if(''===this.cardNumInput.val().trim()||this.cardNumInput.is(':focus')&&''===this.cardCvvInput.val().trim()){return;}
if(!this.isCvvCorrect()||''===this.cardCvvInput.val().trim()){this.setError(this.cardCvvInput);}else{this.setCorrect(this.cardCvvInput);}},validateCardExpiryDate:function(){console.log(this.cardExpiryMonthInput.val(),this.cardExpiryYear.val());if(!$.payform.validateCardExpiry(this.cardExpiryMonthInput.val(),this.cardExpiryYear.val())){this.setError(this.cardCvvInput);return false;}else{this.setCorrect(this.cardCvvInput);return true;}},getExpiryDate:function(){if(!this.validateCardExpiryDate()){return false;}
return $.payform.parseCardExpiry(this.cardExpiryMonthInput+' / '+this.cardExpiryYear);},showCvvInfo:function(){cardHandler.cvvInfoOpenInProgress=true;$('#cvv-popup').fadeIn('fast',function(){cardHandler.cvvInfoOpenInProgress=false;})},unmarkCardIcon:function(){$('.card-icon').children('input').removeAttr('checked');},markCardIcon:function(){this.unmarkCardIcon();var curr_card_type=this.getCardType();if(curr_card_type=="mastercard"){this.cardCvvLabel.text('CVC2');}else if(curr_card_type=="visa"){this.cardCvvLabel.text('CVV2');}else{this.cardCvvLabel.text(this.cardCvvLabelText);}
if(this.cardSystemArray.includes(curr_card_type)){$('#card_icon_'+curr_card_type).children('input').attr('checked','checked');}else{$('input[name="creditCard[system]"]').removeAttr('checked');}},getCardType:function(){return $.payform.parseCardType(cardHandler.cardNumInput.val())}};(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}
var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}
return n[i].exports}
for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}
return r})()({1:[function(require,module,exports){var payform;payform=require(2);(function($){$.payform=payform;$.payform.fn={formatCardNumber:function(){return payform.cardNumberInput(this.get(0));},formatCardExpiry:function(){return payform.expiryInput(this.get(0));},formatCardCVC:function(){return payform.cvcInput(this.get(0));},formatNumeric:function(){return payform.numericInput(this.get(0));},detachFormatCardNumber:function(){return payform.detachCardNumberInput(this.get(0));},detachFormatCardExpiry:function(){return payform.detachExpiryInput(this.get(0));},detachFormatCardCVC:function(){return payform.detachCvcInput(this.get(0));},detachFormatNumeric:function(){return payform.detachNumericInput(this.get(0));},fitYearSelect:function(monthInt){return payform.fitYearSelect(this.get(0)[0],monthInt);}};return $.fn.payform=function(method){if($.payform.fn[method]!=null){$.payform.fn[method].call(this);}
return this;};})(window.jQuery||window.Zepto);},{"2":2}],2:[function(require,module,exports){var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i;}
return-1;};(function(name,definition){if(typeof module!=="undefined"&&module!==null){return module.exports=definition();}else if(typeof define==='function'&&typeof define.amd==='object'){return define(name,definition);}else{return this[name]=definition();}})('payform',function(){var _eventNormalize,_getCaretPos,_off,_on,attachEvents,cardFromNumber,cardFromType,defaultFormat,eventList,formatBackCardNumber,formatBackExpiry,formatCardExpiry,formatCardNumber,fitYearSelect,formatForwardExpiry,formatForwardSlashAndSpace,getDirectionality,hasTextSelected,keyCodes,luhnCheck,payform,reFormatCVC,reFormatCardNumber,reFormatExpiry,replaceFullWidthChars,restrictCVC,restrictCardNumber,restrictExpiry,restrictNumeric;_getCaretPos=function(ele){var r,rc,re;if(ele.selectionStart!=null){return ele.selectionStart;}else if(document.selection!=null){ele.focus();r=document.selection.createRange();re=ele.createTextRange();rc=re.duplicate();re.moveToBookmark(r.getBookmark());rc.setEndPoint('EndToStart',re);return rc.text.length;}};_eventNormalize=function(listener){return function(e){var newEvt;if(e==null){e=window.event;}
if(e.inputType==='insertCompositionText'&&!e.isComposing){return;}
newEvt={target:e.target||e.srcElement,which:e.which||e.keyCode,type:e.type,metaKey:e.metaKey,ctrlKey:e.ctrlKey,preventDefault:function(){if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}}};return listener(newEvt);};};_on=function(ele,event,listener){if(ele.addEventListener!=null){return ele.addEventListener(event,listener,false);}else{return ele.attachEvent("on"+event,listener);}};_off=function(ele,event,listener){if(ele.removeEventListener!=null){return ele.removeEventListener(event,listener,false);}else{return ele.detachEvent("on"+event,listener);}};payform={};keyCodes={UNKNOWN:0,BACKSPACE:8,PAGE_UP:33,ARROW_LEFT:37,ARROW_RIGHT:39};defaultFormat=/(\d{1,4})/g;payform.cards=[{type:'elo',pattern:/^(4011(78|79)|43(1274|8935)|45(1416|7393|763(1|2))|50(4175|6699|67[0-7][0-9]|9000)|627780|63(6297|6368)|650(03([^4])|04([0-9])|05(0|1)|4(0[5-9]|3[0-9]|8[5-9]|9[0-9])|5([0-2][0-9]|3[0-8])|9([2-6][0-9]|7[0-8])|541|700|720|901)|651652|655000|655021)/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'visaelectron',pattern:/^4(026|17500|405|508|844|91[37])/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'maestro',pattern:/^(5018|5020|5038|6304|6390[0-9]{2}|67[0-9]{4})/,format:defaultFormat,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:true},{type:'forbrugsforeningen',pattern:/^600/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'dankort',pattern:/^5019/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'visa',pattern:/^4/,format:defaultFormat,length:[13,16,19],cvcLength:[3],luhn:true},{type:'mastercard',pattern:/^(5[1-5][0-9]{4}|677189)|^(222[1-9]|2[3-6]\d{2}|27[0-1]\d|2720)([0-9]{2})/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'amercianexpress',pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[4],luhn:true},{type:'hipercard',pattern:/^(384100|384140|384160|606282|637095|637568|60(?!11))/,format:defaultFormat,length:[14,15,16,17,18,19],cvcLength:[3],luhn:true},{type:'dinersclub',pattern:/^(36|38|30[0-5])/,format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:true},{type:'discover',pattern:/^(6011|65|64[4-9]|622)/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'unionpay',pattern:/^62/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:false},{type:'jcb',pattern:/^35/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:true},{type:'laser',pattern:/^(6706|6771|6709)/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:true}];cardFromNumber=function(num){var card,i,len,ref;num=(num+'').replace(/\D/g,'');ref=payform.cards;for(i=0,len=ref.length;i<len;i++){card=ref[i];if(card.pattern.test(num)){return card;}}};cardFromType=function(type){var card,i,len,ref;ref=payform.cards;for(i=0,len=ref.length;i<len;i++){card=ref[i];if(card.type===type){return card;}}};getDirectionality=function(target){var style;style=getComputedStyle(target);return style&&style['direction']||document.dir;};luhnCheck=function(num){var digit,digits,i,len,odd,sum;odd=true;sum=0;digits=(num+'').split('').reverse();for(i=0,len=digits.length;i<len;i++){digit=digits[i];digit=parseInt(digit,10);if((odd=!odd)){digit*=2;}
if(digit>9){digit-=9;}
sum+=digit;}
return sum%10===0;};hasTextSelected=function(target){var ref;if((typeof document!=="undefined"&&document!==null?(ref=document.selection)!=null?ref.createRange:void 0:void 0)!=null){if(document.selection.createRange().text){return true;}}
return(target.selectionStart!=null)&&target.selectionStart!==target.selectionEnd;};replaceFullWidthChars=function(str){var char,chars,fullWidth,halfWidth,i,idx,len,value;if(str==null){str='';}
fullWidth='\uff10\uff11\uff12\uff13\uff14\uff15\uff16\uff17\uff18\uff19';halfWidth='0123456789';value='';chars=str.split('');for(i=0,len=chars.length;i<len;i++){char=chars[i];idx=fullWidth.indexOf(char);if(idx>-1){char=halfWidth[idx];}
value+=char;}
return value;};reFormatCardNumber=function(e){var cursor;cursor=_getCaretPos(e.target);if(e.target.value===""){return;}
if(getDirectionality(e.target)==='ltr'){cursor=_getCaretPos(e.target);}
e.target.value=payform.formatCardNumber(e.target.value);if(getDirectionality(e.target)==='ltr'&&cursor!==e.target.selectionStart){cursor=_getCaretPos(e.target);}
if(getDirectionality(e.target)==='rtl'&&e.target.value.indexOf('‎\u200e')===-1){e.target.value='‎\u200e'.concat(e.target.value);}
cursor=_getCaretPos(e.target);if((cursor!=null)&&cursor!==0&&e.type!=='change'){return e.target.setSelectionRange(cursor,cursor);}};formatCardNumber=function(e){var card,cursor,digit,length,re,upperLength,value;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
value=e.target.value;card=cardFromNumber(value+digit);length=(value.replace(/\D/g,'')+digit).length;upperLength=16;if(card){upperLength=card.length[card.length.length-1];}
if(length>=upperLength){return;}
cursor=_getCaretPos(e.target);if(cursor&&cursor!==value.length){return;}
if(card&&card.type==='amercianexpress'){re=/^(\d{4}|\d{4}\s\d{6})$/;}else{re=/(?:^|\s)(\d{4})$/;}
if(re.test(value)){e.preventDefault();return setTimeout(function(){return e.target.value=value+" "+digit;});}else if(re.test(value+digit)){e.preventDefault();return setTimeout(function(){return e.target.value=(value+digit)+" ";});}};formatBackCardNumber=function(e){var cursor,value;value=e.target.value;if(e.which!==keyCodes.BACKSPACE){return;}
cursor=_getCaretPos(e.target);if(cursor&&cursor!==value.length){return;}
if((e.target.selectionEnd-e.target.selectionStart)>1){return;}
if(/\d\s$/.test(value)){e.preventDefault();return setTimeout(function(){return e.target.value=value.replace(/\d\s$/,'');});}else if(/\s\d?$/.test(value)){e.preventDefault();return setTimeout(function(){return e.target.value=value.replace(/\d$/,'');});}};reFormatExpiry=function(e){var cursor;if(e.target.value===""){return;}
e.target.value=payform.formatCardExpiry(e.target.value);if(getDirectionality(e.target)==='rtl'&&e.target.value.indexOf('‎\u200e')===-1){e.target.value='‎\u200e'.concat(e.target.value);}
cursor=_getCaretPos(e.target);if((cursor!=null)&&e.type!=='change'){return e.target.setSelectionRange(cursor,cursor);}};formatCardExpiry=function(e){var digit,val;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
val=e.target.value+digit;if(/^\d$/.test(val)&&(val!=='0'&&val!=='1')){e.preventDefault();return setTimeout(function(){return e.target.value="0"+val+" / ";});}else if(/^\d\d$/.test(val)){e.preventDefault();return setTimeout(function(){return e.target.value=val+" / ";});}};formatForwardExpiry=function(e){var digit,val;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
val=e.target.value;if(/^\d\d$/.test(val)){return e.target.value=val+" / ";}};formatForwardSlashAndSpace=function(e){var val,which;which=String.fromCharCode(e.which);if(!(which==='/'||which===' ')){return;}
val=e.target.value;if(/^\d$/.test(val)&&val!=='0'){return e.target.value="0"+val+" / ";}};formatBackExpiry=function(e){var cursor,value;value=e.target.value;if(e.which!==keyCodes.BACKSPACE){return;}
cursor=_getCaretPos(e.target);if(cursor&&cursor!==value.length){return;}
if(/\d\s\/\s$/.test(value)){e.preventDefault();return setTimeout(function(){return e.target.value=value.replace(/\d\s\/\s$/,'');});}};reFormatCVC=function(e){var cursor;if(e.target.value===""){return;}
cursor=_getCaretPos(e.target);e.target.value=replaceFullWidthChars(e.target.value).replace(/\D/g,'').slice(0,4);if((cursor!=null)&&e.type!=='change'){return e.target.setSelectionRange(cursor,cursor);}};restrictNumeric=function(e){var input;if(e.metaKey||e.ctrlKey){return;}
if([keyCodes.UNKNOWN,keyCodes.ARROW_LEFT,keyCodes.ARROW_RIGHT].indexOf(e.which)>-1){return;}
if(e.which<keyCodes.PAGE_UP){return;}
input=String.fromCharCode(e.which);if(!/^\d+$/.test(input)){return e.preventDefault();}};restrictCardNumber=function(e){var card,digit,maxLength,value;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
if(hasTextSelected(e.target)){return;}
value=(e.target.value+digit).replace(/\D/g,'');card=cardFromNumber(value);maxLength=card?card.length[card.length.length-1]:16;if(value.length>maxLength){return e.preventDefault();}};restrictExpiry=function(e){var digit,value;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
if(hasTextSelected(e.target)){return;}
value=e.target.value+digit;value=value.replace(/\D/g,'');if(value.length>6){return e.preventDefault();}};restrictCVC=function(e){var digit,val;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
if(hasTextSelected(e.target)){return;}
val=e.target.value+digit;if(val.length>4){return e.preventDefault();}};eventList={cvcInput:[{eventName:'keypress',eventHandler:_eventNormalize(restrictNumeric)},{eventName:'keypress',eventHandler:_eventNormalize(restrictCVC)},{eventName:'paste',eventHandler:_eventNormalize(reFormatCVC)},{eventName:'change',eventHandler:_eventNormalize(reFormatCVC)},{eventName:'input',eventHandler:_eventNormalize(reFormatCVC)}],expiryInput:[{eventName:'keypress',eventHandler:_eventNormalize(restrictNumeric)},{eventName:'keypress',eventHandler:_eventNormalize(restrictExpiry)},{eventName:'keypress',eventHandler:_eventNormalize(formatCardExpiry)},{eventName:'keypress',eventHandler:_eventNormalize(formatForwardSlashAndSpace)},{eventName:'keypress',eventHandler:_eventNormalize(formatForwardExpiry)},{eventName:'keydown',eventHandler:_eventNormalize(formatBackExpiry)},{eventName:'change',eventHandler:_eventNormalize(reFormatExpiry)},{eventName:'input',eventHandler:_eventNormalize(reFormatExpiry)}],cardNumberInput:[{eventName:'keypress',eventHandler:_eventNormalize(restrictNumeric)},{eventName:'keypress',eventHandler:_eventNormalize(restrictCardNumber)},{eventName:'keypress',eventHandler:_eventNormalize(formatCardNumber)},{eventName:'keydown',eventHandler:_eventNormalize(formatBackCardNumber)},{eventName:'paste',eventHandler:_eventNormalize(reFormatCardNumber)},{eventName:'change',eventHandler:_eventNormalize(reFormatCardNumber)},{eventName:'input',eventHandler:_eventNormalize(reFormatCardNumber)}],numericInput:[{eventName:'keypress',eventHandler:_eventNormalize(restrictNumeric)},{eventName:'paste',eventHandler:_eventNormalize(restrictNumeric)},{eventName:'change',eventHandler:_eventNormalize(restrictNumeric)},{eventName:'input',eventHandler:_eventNormalize(restrictNumeric)}]};attachEvents=function(input,events,detach){var evt,i,len;for(i=0,len=events.length;i<len;i++){evt=events[i];if(detach){_off(input,evt.eventName,evt.eventHandler);}else{_on(input,evt.eventName,evt.eventHandler);}}};payform.cvcInput=function(input){return attachEvents(input,eventList.cvcInput);};payform.expiryInput=function(input){return attachEvents(input,eventList.expiryInput);};payform.cardNumberInput=function(input){return attachEvents(input,eventList.cardNumberInput);};payform.numericInput=function(input){return attachEvents(input,eventList.numericInput);};payform.detachCvcInput=function(input){return attachEvents(input,eventList.cvcInput,true);};payform.detachExpiryInput=function(input){return attachEvents(input,eventList.expiryInput,true);};payform.detachCardNumberInput=function(input){return attachEvents(input,eventList.cardNumberInput,true);};payform.detachNumericInput=function(input){return attachEvents(input,eventList.numericInput,true);};payform.parseCardExpiry=function(value){var month,prefix,ref,year;value=value.replace(/\s/g,'');ref=value.split('/',2),month=ref[0],year=ref[1];if((year!=null?year.length:void 0)===2&&/^\d+$/.test(year)){prefix=(new Date).getFullYear();prefix=prefix.toString().slice(0,2);year=prefix+year;}
month=parseInt(month.replace(/[\u200e]/g,""),10);year=parseInt(year,10);return{month:month,year:year};};payform.validateCardNumber=function(num){var card,ref;num=(num+'').replace(/\s+|-/g,'');if(!/^\d+$/.test(num)){return false;}
card=cardFromNumber(num);if(!card){return false;}
return(ref=num.length,indexOf.call(card.length,ref)>=0)&&(card.luhn===false||luhnCheck(num));};payform.validateCardExpiry=function(month,year){var currentTime,expiry,ref;if(typeof month==='object'&&'month'in month){ref=month,month=ref.month,year=ref.year;}
if(!(month&&year)){return false;}
month=String(month).trim();year=String(year).trim();if(!/^\d+$/.test(month)){return false;}
if(!/^\d+$/.test(year)){return false;}
if(!((1<=month&&month<=12))){return false;}
if(year.length===2){if(year<70){year="20"+year;}else{year="19"+year;}}
if(year.length!==4){return false;}
expiry=new Date(year,month);currentTime=new Date;expiry.setMonth(expiry.getMonth()-1);expiry.setMonth(expiry.getMonth()+1,1);return expiry>currentTime;};payform.validateCardCVC=function(cvc,type){var card,ref;cvc=String(cvc).trim();if(!/^\d+$/.test(cvc)){return false;}
card=cardFromType(type);if(card!=null){return ref=cvc.length,indexOf.call(card.cvcLength,ref)>=0;}else{return cvc.length>=3&&cvc.length<=4;}};payform.parseCardType=function(num){var ref;if(!num){return null;}
return((ref=cardFromNumber(num))!=null?ref.type:void 0)||null;};payform.formatCardNumber=function(num){var card,groups,ref,upperLength;num=replaceFullWidthChars(num);num=num.replace(/\D/g,'');card=cardFromNumber(num);if(!card){return num;}
upperLength=card.length[card.length.length-1];num=num.slice(0,upperLength);if(card.format.global){return(ref=num.match(card.format))!=null?ref.join(' '):void 0;}else{groups=card.format.exec(num);if(groups==null){return;}
groups.shift();groups=groups.filter(Boolean);return groups.join(' ');}};payform.fitYearSelect=function(yearSelect,monthInt){yearSelect=yearSelect[0];monthInt=parseInt(monthInt)-1;if(monthInt<0){return false;}
var currentMonth=new Date().getMonth();if(monthInt<currentMonth){var options=yearSelect.getElementsByTagName('option');for(var i=0;i<options.length;i++){if(parseInt(options[i].value)===new Date().getFullYear()){options[i].classList.add('hidden');yearSelect.value=new Date().getFullYear()+1;break;}}}else{var hiddenYear=yearSelect.querySelectorAll('option.hidden');if(hiddenYear.length){hiddenYear[0].classList.remove('hidden');}}};payform.formatCardExpiry=function(expiry){var mon,parts,sep,year;expiry=replaceFullWidthChars(expiry);parts=expiry.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/);if(!parts){return'';}
mon=parts[1]||'';sep=parts[2]||'';year=parts[3]||'';if(year.length>0){sep=' / ';}else if(sep===' /'){mon=mon.substring(0,1);sep='';}else if(mon.length===2||sep.length>0){sep=' / ';}else if(mon.length===1&&(mon!=='0'&&mon!=='1')){mon="0"+mon;sep=' / ';}
return mon+sep+year;};return payform;});},{}]},{},[1]);