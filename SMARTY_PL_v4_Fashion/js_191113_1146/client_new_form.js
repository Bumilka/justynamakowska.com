
var client_new={timeHandle:'',afterCheckEmail:function(json){if(!json.login){if(json.client_exists){var html='<div id="dialog_client_mail_propose1"><div class="propose_main"><div class="propose_info">'
+clientnew_00_txt+'<div class="propose_json_mail">'+json.mail+'</div>';if(json.external_service){html+=clientnew_08_txt+' '+json.external_service.name;}
html+='</div>';html+='<p class="cn_propose_desc">'+clientnew_13_txt+'</p>';html+='<div class="cn_propose_desc">';html+='<div><a class="btn button_password_recover" href="/password-recover.php?operation=recover&email='+json.mail+'">'+clientnew_03_txt+'</a></div>';html+='<div><a href="/signin.php">'+clientnew_01_txt+'</a></div>';html+='<div><a href="#close" onclick="$(\'#dialog_close\').click(); return false;">'+clientnew_02_txt+'</a></div>';html+='</div>';$('body').dialog({content:html});if(json.client_propose_login&&!$('#client_login').val()){$('#client_login').val(json.client_propose_login);}}}},enabled:function(obj){obj.find('input,select.delivery_countries, .client_provinces:visible select').attr('disabled',false);},disabled:function(obj){obj.find('input,select.delivery_countries, .client_provinces:visible select').not('[name=delivery_id],[name=default_delivery_id]').attr('disabled',true);obj.find('.validate_message').remove();obj.find('.has-error').removeClass('has-error');obj.find('.has-success').removeClass('has-success');},resetRequiredClass:function(obj){$('#client_new_form input.validate[required]').parent().not('.has-success,.has-error,.checkbox').addClass('has-required');},copy_select:function(){if($('#delivery_region').is(':disabled')){client_new.enabled($('div.delivery_box'));$('#delivery_region').val($('#client_region').val()).change();client_new.disabled($('div.delivery_box'));$('select[name=delivery_province]:visible').val($('select[name=client_province]:visible').val());}},copy_adress:function(){$('#client_new_form input[data-copy]').each(function(){$this=$(this);var el=$('#'+$this.data('copy'));if(el.is(':disabled'))
el.val($this.val());});client_new.copy_select();},copy_validation:function(){$('#client_new_form input[data-copy]').each(function(){$this=$(this);var $thisparent=$this.parent();var el=$('#'+$this.data('copy'));var message=$this.parents('.form-group').find('.validate_message').html();if(!el.is(':disabled')&&el.val()&&$this.val()==el.val()){if($thisparent.is('.has-error')){el.parent().removeClass('has-required').addClass('has-error');el.parents('.form-group').find(' > div').append('<span class="help-block validate_message text-danger">'+message+'</span>');}
if($thisparent.is('.has-success')){el.parent().removeClass('has-required').addClass('has-success');}}});},useVat:function(){var currCountry=$('#client_new_form [name=client_region]').val();if(($('#client_new_form [name=client_region] option[value="'+currCountry+'"]').data('vat_company')=='n'||($('#client_new_form [name=client_region] option[value="'+currCountry+'"]').data('vat_company')==''&&$('#client_new_form [name=client_region] option[value="'+currCountry+'"]').data('vat')=='y'))&&$('input[name="client_type"]:checked').val()=='firm'){$('#vat_company').parents('div.checkbox').show();}else{$('#vat_company').parents('div.checkbox').hide();}},addSucces:function(obj){if(obj.is('[type=checkbox]')){obj=obj.parents('div.checkbox');}else{obj=obj.parent();}
client_new.clearValidation(obj);obj.addClass('has-success');},addError:function(obj){if(obj.is('[type=checkbox]')){obj=obj.parents('div.checkbox');}else{obj=obj.parent();}
client_new.clearValidation(obj);obj.addClass('has-error');},clearValidation:function(obj){obj.removeClass('has-success').removeClass('has-error').removeClass('has-required');},removeErrorInfo:function(obj){obj.parent().find('.validate_message').remove();},checkValidateFields:function(onlyErrors){var inputs=$('#client_new_form input.validate:enabled:visible:not([readonly])');var checkbox=$('#client_new_form input#terms_agree[required]').not('[disabled]').not(':checked');var empty=true;var required=true
if(inputs.size()){inputs.each(function(){$this=$(this);empty=!$.trim($this.val());required=$this.is('[required]');client_new.removeErrorInfo($this);if(required&&empty){client_new.addError($this);$this.parent().append('<span class="help-block validate_message text-danger">'+"Proszę wypełnić to pole."+'</span>');checkbox.each(function(){$this=$(this);client_new.addError($this);});}else if(!empty){if(!onlyErrors)
client_new.addSucces($this);}else{if(!onlyErrors)
client_new.clearValidation($this.parent());}});client_new.resetRequiredClass();var error_item=$('#client_new_form .has-error:visible:first');if(error_item.size()){$("html, body").animate({scrollTop:$('#client_new_form .has-error:visible:first').offset().top-10},300);return false;}}},validate:function(obj,callbackSuccess){var data=obj.serialize();var wrapper=obj.parent();if(obj.data('serialize')){data+='&'+$(obj.data('serialize')).serialize();}
if(obj.data('revalidate')){$(obj.data('revalidate')).each(function(){client_new.validate($(this));});}
if(obj.val()==''){client_new.clearValidation(wrapper)
if(obj.is('[required]')){wrapper.addClass('has-required');}
client_new.removeErrorInfo(obj);return false;}
$.post('/ajax/client-new.php?validAjax=true',data,function(json){if(json.errno){var error_message='';if(json.message.error_code){if(json.message.zipcode_pattern&&(json.message.error_code=='incorect_zipcode'||json.message.error_code=='incorect_delivery_zipcode')){error_message=clientNewErrorCode[json.message.error_code]+' '+clientnew_14_txt+' ';error_message+=json.message.zipcode_pattern.join(', ');}else if((json.message.error_code=='password_to_short'||json.message.error_code=='password_to_long')){if(json.message.error_code=='password_to_short')
error_message=clientNewErrorCode['password_to_short']+' '+ClNewPasswordLengthMin+' '+clientnew_15c_txt;if(json.message.error_code=='password_to_long')
error_message=clientNewErrorCode['password_to_long']+' '+ClNewPasswordLengthMax+' '+clientnew_15c_txt;}else if(clientNewErrorCode[json.message.error_code]){error_message=clientNewErrorCode[json.message.error_code];}}
client_new.addError(obj);if(error_message){client_new.removeErrorInfo(obj);obj.parent().append('<span class="help-block validate_message text-danger">'+error_message+'</span>');}}else{client_new.addSucces(obj);client_new.removeErrorInfo(obj);if(obj.is('[name=client_email]')){$.post('ajax/client-new.php?checkClientExists=true',{'client_mail':$('#client_email').val()},function(json){client_new.afterCheckEmail(json);},'json')}
if(callbackSuccess)callbackSuccess();}},'json')},focused:function(obj){if(obj.val()!=''){obj.addClass('focused');}
else{obj.removeClass('focused');}},init:function(){$("#birth_date").datepicker({dateFormat:iaical_dateFormat,dayNamesMin:iaical_daysShort,monthNames:iaical_monthNames,monthNamesShort:iaical_shortNames,nextText:iaical_monthNext,prevText:iaical_monthPrev,buttonText:' ',firstDay:iaical_firstDay,changeMonth:true,changeYear:true,onSelect:function(){client_new.validate($("#birth_date"));client_new.focused($("#birth_date"));},maxDate:'+0',minDate:new Date(1920,1-1,1),yearRange:'-100:+0'});$('#client_new_form button[type=submit]').click(function(){client_new.checkValidateFields(true);})
$('.form-group input.validate').die('input.c_new');$('.form-group input.validate').live('input.c_new',function(){clearTimeout(client_new.timeHandle);obj=$(this);client_new.timeHandle=setTimeout(function(){client_new.validate(obj);},500);});$('.form-group input.validate').off('change');$('.form-group input.validate').on('change',function(){client_new.validate($(this));});$('#client_new_form select.delivery_countries').die('change.c_new');$('#client_new_form select.delivery_countries').live('change.c_new',function(){var obj=$(this);var wrapper=obj.parents('.cn_wrapper');wrapper.find('div.client_provinces').hide();wrapper.find('div.client_provinces select').attr('disabled',true);var element=$('#'+obj.attr('name')+'_'+obj.val());element.show().find('select').attr('disabled',false);client_new.useVat();$('#'+obj.attr('name').replace('region','zipcode')).trigger('input.c_new');});$('#client_new_form input[name=client_type]').die('click.c_new');$('#client_new_form input[name=client_type]').live('click.c_new',function(){var obj=$('div.firm-group');if($(this).val()=='private'){obj.hide();is_firm=false;client_new.disabled(obj);client_new.useVat();}else{obj.show();is_firm=true;client_new.enabled(obj);client_new.useVat();}});$('#delivery_box_switcher input').die('click.c_new');$('#delivery_box_switcher input').live('click.c_new',function(){var d_box=$('div.delivery_box');if($(this).prop('checked')===true){$('#client_new_form').removeClass('deliver_to_billingaddr');client_new.enabled(d_box);}else{$('#client_new_form').addClass('deliver_to_billingaddr');client_new.disabled(d_box);client_new.resetRequiredClass();}});$('#invoice_box_switcher input').die('click.c_new');$('#invoice_box_switcher input').live('click.c_new',function(){var d_box=$('#client_new_invoice');if($(this).prop('checked')===true){$('#client_new_form').removeClass('invoice_to_billingaddr');client_new.enabled(d_box);}else{$('#client_new_form').addClass('invoice_to_billingaddr');client_new.disabled(d_box);client_new.resetRequiredClass();}});$('#client_new_form input[name=client_generate_password_n]').die('click.c_new');$('#client_new_form input[name=client_generate_password_n]').live('click.c_new',function(){if($(this).val()=='y'){$('div.password-group').hide();client_new.disabled($('div.password-group'));}else{$('div.password-group').show();client_new.enabled($('div.password-group'));}});$('#client_new_form #terms_agree').die('click.c_new');$('#client_new_form #terms_agree').live('click.c_new',function(){$(this).parents('div.checkbox').removeClass('has-error');});$('#client_new_form .dropdown-menu li > a').die('click.c_new');$('#client_new_form .dropdown-menu li > a').live('click.c_new',function(){var adress={};$this=$(this);var wrapper=$this.data('wrapper');adress.id=$this.data('id');adress.additional=$this.find('.data-additional').text();adress.firstname=$this.find('.data-firstname').text();adress.lastname=$this.find('.data-lastname').text();adress.street=$this.find('.data-street').text();adress.city=$this.find('.data-city').text();adress.zipcode=$this.data('zipcode');adress.phone=$this.data('phone');adress.region_id=$this.data('region_id');adress.country_name=$this.data('country_name');adress.editable=$this.data('editable');adress.used=$this.data('used');$(wrapper).find('.dropdown-menu li > a.active').removeClass('active');$(this).addClass('active');$.each(adress,function(key,value){$(wrapper).find('input[id$="'+key+'"]').val(value);});$(wrapper).find('select.delivery_countries').val(adress.region_id);$(wrapper).find('.addresse_id').val(adress.id);if(adress.editable=='yes'){client_new.enabled($(wrapper));}else{client_new.disabled($(wrapper));}
if(adress.removable=='yes'){$(wrapper).find('.delete_address').show();}else{$(wrapper).find('.delete_address').hide();}
if(adress.province){$(wrapper).find('.client_provinces').show();$(wrapper).find('.client_provinces select').val(adress.province);}else{$(wrapper).find('.client_provinces').hide();}
client_new.checkValidateFields(false);});$('#client_new_form #new_delivery_address').die('click.c_new');$('#client_new_form #new_delivery_address').live('click.c_new',function(){var activeCountry=$('#client_new_additional').data('active-country');var inputs=$('div.additional_box').find('input,select.delivery_countries').not('[type=hidden]');$('#client_new_form #delivery_id').val('');inputs.attr('disabled',false).val('');inputs.each(function(){client_new.clearValidation($(this).parent());client_new.focused($(this));});$('select#additional_region').val(activeCountry);client_new.resetRequiredClass();$('#client_new_form #dropdownAdressMenu').parents('.form-group').css('visibility','hidden');$('#client_new_form #new_delivery_address').hide();$('#client_new_form #save_delivery_address').show();return false;})
client_new.useVat();if(client_new_mode=='edit')
client_new.checkValidateFields(false);$('#client_new_form #client_password').on('input',function(){$('#repeat_password').val($(this).val());});$('#client_new_login .show_pass').off('click');$('#client_new_login .show_pass').on('click',function(){if($('#client_new_form #client_password').prop('type')==='password'){$('#client_new_form #client_password').prop('type','text');$(this).html(clientnew_16b_txt);}else{$('#client_new_form #client_password').prop('type','password');$(this).html(clientnew_16a_txt);}
return false;});}}
app_shop.run(function(){client_new.init();},'all','#client_new_form');